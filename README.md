# A Simple RAT With Encrypted Communication

使用端到端加密方法实现安全通信

## 加密方法介绍
1. 双向身份认证  
   - 签名与验证：双方使用签名私钥对各自的密钥交换公钥以及消息进行签名，接收方通过发送方的签名公钥验证签名确保公钥和消息的真实性和完整性，防止中间人攻击。

2. 安全的密钥协商  
   - 密钥交换协议（如ECDH）：基于非对称加密，双方独立生成相同的共享密钥，无需直接传输密钥本身。  
   - KDF（密钥派生函数）：将初始共享密钥扩展为高强度加密密钥，抵御暴力破解。

3. 数据加密与完整性保护 
   - AEAD加密算法（如AES-GCM）：集成加密与认证，同时保障消息机密性、完整性和身份验证，防止篡改和伪造。

## 测试及结果
server，agent，client需要分别在3个终端下测试

### 测试server

终端1

```
$ cargo run -p server
```

### 测试agent

终端2

```
$ cargo run -p agent
```

### 测试client

终端3

- 获取agent信息


```
$ cargo run -p client -- agents
+--------------------------------------+--------------------------------+--------------------------------+----------------------------------------------+----------------------------------------------+
| Agent ID                             | Created At                     | Last Seen At                   | Signing Public Key                           | Public Prekey                                |
+======================================================================================================================================================================================================+
| 4761027e-9618-4892-862d-fd16efae8191 | 2025-04-18 06:36:56.174777 UTC | 2025-04-18 06:38:41.760965 UTC | Bbleu6Idm1m/NGoKS7OQcbymUwOnXUIGr98YnBDs+lE= | jbkRdrWeoug0nHCzVrHL7ljNWhIFeUHfQ//ByjHhiWo= |
+--------------------------------------+--------------------------------+--------------------------------+----------------------------------------------+----------------------------------------------+
```

- 为agent添加执行命令

```
$ cargo run -p client -- exec -a 4761027e-9618-4892-862d-fd16efae8191 --command "echo hello world!"
hello world!
```

## 待完善or计划

- [ ] 优化agent，使它体积更小巧
- [ ] 拓展更多功能，不仅仅是命令执行